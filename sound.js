// sound.js  (generiert)
window.Sound = (function () {
  let enabled = true;

  function setEnabled(v) { enabled = !!v; }
  function isEnabled() { return enabled; }

  // Eventliste: n = Note (z.B. "C4"), s16 = Start in 1/16, d16 = Dauer in 1/16, v = Velocity (0..1)
  const EVENTS = [
  {
    "n": "B5",
    "s16": 264,
    "d16": 1,
    "v": 0.9763779527559056
  },
  {
    "n": "A5",
    "s16": 265,
    "d16": 1,
    "v": 0.9763779527559056
  },
  {
    "n": "B5",
    "s16": 267,
    "d16": 1,
    "v": 0.9763779527559056
  },
  {
    "n": "F#5",
    "s16": 268,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D5",
    "s16": 269,
    "d16": 1,
    "v": 0.984251968503937
  },
  {
    "n": "F#5",
    "s16": 271,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B4",
    "s16": 272,
    "d16": 1,
    "v": 0.9763779527559056
  },
  {
    "n": "B5",
    "s16": 275,
    "d16": 1,
    "v": 0.9763779527559056
  },
  {
    "n": "A5",
    "s16": 276,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 277,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#5",
    "s16": 279,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D5",
    "s16": 280,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#5",
    "s16": 281,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B4",
    "s16": 283,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 285,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "C#6",
    "s16": 287,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D6",
    "s16": 288,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "C#6",
    "s16": 289,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D6",
    "s16": 291,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 292,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "C#6",
    "s16": 293,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 295,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "C#6",
    "s16": 296,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "A5",
    "s16": 297,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 299,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "A5",
    "s16": 300,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 301,
    "d16": 1,
    "v": 0.9763779527559056
  },
  {
    "n": "G5",
    "s16": 303,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 304,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 307,
    "d16": 1,
    "v": 0.9763779527559056
  },
  {
    "n": "A5",
    "s16": 308,
    "d16": 1,
    "v": 0.9763779527559056
  },
  {
    "n": "B5",
    "s16": 309,
    "d16": 1,
    "v": 0.9763779527559056
  },
  {
    "n": "F#5",
    "s16": 311,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D5",
    "s16": 312,
    "d16": 1,
    "v": 0.984251968503937
  },
  {
    "n": "F#5",
    "s16": 313,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B4",
    "s16": 315,
    "d16": 1,
    "v": 0.9763779527559056
  },
  {
    "n": "B5",
    "s16": 317,
    "d16": 1,
    "v": 0.9763779527559056
  },
  {
    "n": "A5",
    "s16": 319,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 320,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#5",
    "s16": 321,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D5",
    "s16": 323,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#5",
    "s16": 324,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B4",
    "s16": 325,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 328,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "C#6",
    "s16": 329,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D6",
    "s16": 331,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "C#6",
    "s16": 332,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D6",
    "s16": 333,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 335,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "C#6",
    "s16": 336,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 337,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "C#6",
    "s16": 339,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "A5",
    "s16": 340,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 341,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "A5",
    "s16": 343,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 344,
    "d16": 1,
    "v": 0.9763779527559056
  },
  {
    "n": "C#6",
    "s16": 345,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "D6",
    "s16": 347,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#6",
    "s16": 349,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "E6",
    "s16": 351,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#6",
    "s16": 352,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D6",
    "s16": 353,
    "d16": 1,
    "v": 0.9763779527559056
  },
  {
    "n": "A5",
    "s16": 355,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D6",
    "s16": 356,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#5",
    "s16": 357,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "F#6",
    "s16": 360,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "E6",
    "s16": 361,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#6",
    "s16": 363,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "D6",
    "s16": 364,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "A5",
    "s16": 365,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D6",
    "s16": 367,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#5",
    "s16": 368,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#6",
    "s16": 371,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "Ab6",
    "s16": 372,
    "d16": 1,
    "v": 0.8661417322834646
  },
  {
    "n": "A6",
    "s16": 373,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "Ab6",
    "s16": 375,
    "d16": 1,
    "v": 0.8661417322834646
  },
  {
    "n": "A6",
    "s16": 376,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#6",
    "s16": 377,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "Ab6",
    "s16": 379,
    "d16": 1,
    "v": 0.8661417322834646
  },
  {
    "n": "F#6",
    "s16": 380,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "Ab6",
    "s16": 381,
    "d16": 1,
    "v": 0.8661417322834646
  },
  {
    "n": "E6",
    "s16": 383,
    "d16": 1,
    "v": 0.7874015748031497
  },
  {
    "n": "F#6",
    "s16": 384,
    "d16": 1,
    "v": 0.7795275590551181
  },
  {
    "n": "E6",
    "s16": 385,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "F#6",
    "s16": 387,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "D6",
    "s16": 388,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "F#6",
    "s16": 389,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#6",
    "s16": 392,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "E6",
    "s16": 393,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#6",
    "s16": 395,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "D6",
    "s16": 396,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "A5",
    "s16": 397,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D6",
    "s16": 399,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#5",
    "s16": 400,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "F#6",
    "s16": 403,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "E6",
    "s16": 404,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#6",
    "s16": 405,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D6",
    "s16": 407,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "A5",
    "s16": 408,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "D6",
    "s16": 409,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#5",
    "s16": 411,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "F#6",
    "s16": 413,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "Ab6",
    "s16": 415,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "A6",
    "s16": 416,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "Ab6",
    "s16": 417,
    "d16": 1,
    "v": 0.7637795275590551
  },
  {
    "n": "A6",
    "s16": 419,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#6",
    "s16": 420,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "Ab6",
    "s16": 421,
    "d16": 1,
    "v": 0.8661417322834646
  },
  {
    "n": "F#6",
    "s16": 423,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "Ab6",
    "s16": 424,
    "d16": 1,
    "v": 0.968503937007874
  },
  {
    "n": "E6",
    "s16": 425,
    "d16": 1,
    "v": 0.8661417322834646
  },
  {
    "n": "F#6",
    "s16": 427,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "E6",
    "s16": 428,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "C#6",
    "s16": 429,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "E6",
    "s16": 431,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "F#6",
    "s16": 432,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "B5",
    "s16": 435,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "A5",
    "s16": 436,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 437,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#5",
    "s16": 439,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D5",
    "s16": 440,
    "d16": 1,
    "v": 0.9763779527559056
  },
  {
    "n": "F#5",
    "s16": 441,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B4",
    "s16": 442,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 445,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "A5",
    "s16": 447,
    "d16": 1,
    "v": 0.9763779527559056
  },
  {
    "n": "B5",
    "s16": 448,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#5",
    "s16": 449,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D5",
    "s16": 451,
    "d16": 1,
    "v": 0.984251968503937
  },
  {
    "n": "F#5",
    "s16": 451,
    "d16": 1,
    "v": 0.7795275590551181
  },
  {
    "n": "B4",
    "s16": 453,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 456,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "C#6",
    "s16": 457,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D6",
    "s16": 459,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "C#6",
    "s16": 460,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D6",
    "s16": 461,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D6",
    "s16": 462,
    "d16": 1,
    "v": 0.984251968503937
  },
  {
    "n": "B5",
    "s16": 463,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "C#6",
    "s16": 464,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "B5",
    "s16": 465,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "C#6",
    "s16": 466,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "C#6",
    "s16": 467,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "A5",
    "s16": 469,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 469,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "A5",
    "s16": 471,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 471,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 473,
    "d16": 1,
    "v": 0.9763779527559056
  },
  {
    "n": "G5",
    "s16": 474,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "B5",
    "s16": 475,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 477,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "A5",
    "s16": 479,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 480,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "F#5",
    "s16": 481,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D5",
    "s16": 483,
    "d16": 1,
    "v": 0.984251968503937
  },
  {
    "n": "F#5",
    "s16": 483,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "B4",
    "s16": 485,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "B5",
    "s16": 488,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "A5",
    "s16": 489,
    "d16": 1,
    "v": 0.9763779527559056
  },
  {
    "n": "B5",
    "s16": 491,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "F#5",
    "s16": 492,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D5",
    "s16": 493,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#5",
    "s16": 494,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B4",
    "s16": 495,
    "d16": 1,
    "v": 0.984251968503937
  },
  {
    "n": "B5",
    "s16": 499,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "C#6",
    "s16": 500,
    "d16": 1,
    "v": 0.9763779527559056
  },
  {
    "n": "D6",
    "s16": 501,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "C#6",
    "s16": 503,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D6",
    "s16": 503,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "D6",
    "s16": 505,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 506,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "C#6",
    "s16": 507,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "B5",
    "s16": 508,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "C#6",
    "s16": 509,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "C#6",
    "s16": 510,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "A5",
    "s16": 511,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 512,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "A5",
    "s16": 513,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 514,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 515,
    "d16": 1,
    "v": 0.9763779527559056
  },
  {
    "n": "C#6",
    "s16": 517,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "D6",
    "s16": 517,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#6",
    "s16": 520,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "E6",
    "s16": 521,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#6",
    "s16": 523,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D6",
    "s16": 524,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "A5",
    "s16": 525,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D6",
    "s16": 526,
    "d16": 1,
    "v": 0.984251968503937
  },
  {
    "n": "F#5",
    "s16": 527,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "F#6",
    "s16": 531,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "E6",
    "s16": 532,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#6",
    "s16": 533,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D6",
    "s16": 535,
    "d16": 1,
    "v": 0.9763779527559056
  },
  {
    "n": "A5",
    "s16": 536,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D6",
    "s16": 537,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "F#5",
    "s16": 538,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "F#6",
    "s16": 541,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "Ab6",
    "s16": 543,
    "d16": 1,
    "v": 0.8661417322834646
  },
  {
    "n": "A6",
    "s16": 544,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "Ab6",
    "s16": 545,
    "d16": 1,
    "v": 0.968503937007874
  },
  {
    "n": "A6",
    "s16": 546,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "A6",
    "s16": 547,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#6",
    "s16": 549,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "Ab6",
    "s16": 549,
    "d16": 1,
    "v": 0.8661417322834646
  },
  {
    "n": "F#6",
    "s16": 551,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "Ab6",
    "s16": 551,
    "d16": 1,
    "v": 0.7637795275590551
  },
  {
    "n": "Ab6",
    "s16": 553,
    "d16": 1,
    "v": 0.8661417322834646
  },
  {
    "n": "E6",
    "s16": 554,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "F#6",
    "s16": 555,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "E6",
    "s16": 556,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#6",
    "s16": 557,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "F#6",
    "s16": 558,
    "d16": 1,
    "v": 0.984251968503937
  },
  {
    "n": "D6",
    "s16": 559,
    "d16": 1,
    "v": 0.984251968503937
  },
  {
    "n": "F#6",
    "s16": 560,
    "d16": 1,
    "v": 0.7795275590551181
  },
  {
    "n": "F#6",
    "s16": 563,
    "d16": 1,
    "v": 0.7795275590551181
  },
  {
    "n": "E6",
    "s16": 564,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#6",
    "s16": 565,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "D6",
    "s16": 567,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "A5",
    "s16": 568,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D6",
    "s16": 569,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "F#5",
    "s16": 570,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "F#6",
    "s16": 573,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "E6",
    "s16": 575,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#6",
    "s16": 576,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D6",
    "s16": 577,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "A5",
    "s16": 579,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "D6",
    "s16": 579,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#5",
    "s16": 581,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "F#6",
    "s16": 584,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "Ab6",
    "s16": 585,
    "d16": 1,
    "v": 0.968503937007874
  },
  {
    "n": "A6",
    "s16": 587,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "Ab6",
    "s16": 588,
    "d16": 1,
    "v": 0.8661417322834646
  },
  {
    "n": "A6",
    "s16": 589,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "A6",
    "s16": 590,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#6",
    "s16": 591,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "Ab6",
    "s16": 592,
    "d16": 1,
    "v": 0.6535433070866141
  },
  {
    "n": "F#6",
    "s16": 593,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "Ab6",
    "s16": 594,
    "d16": 1,
    "v": 0.7637795275590551
  },
  {
    "n": "Ab6",
    "s16": 595,
    "d16": 1,
    "v": 0.8661417322834646
  },
  {
    "n": "E6",
    "s16": 597,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#6",
    "s16": 597,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "C#6",
    "s16": 599,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "E6",
    "s16": 599,
    "d16": 1,
    "v": 0.8503937007874016
  },
  {
    "n": "C#6",
    "s16": 601,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "E6",
    "s16": 601,
    "d16": 1,
    "v": 0.9133858267716536
  },
  {
    "n": "F#6",
    "s16": 603,
    "d16": 27,
    "v": 0.9133858267716536
  },
  {
    "n": "B5",
    "s16": 637,
    "d16": 1,
    "v": 0.9763779527559056
  },
  {
    "n": "A5",
    "s16": 639,
    "d16": 1,
    "v": 0.9763779527559056
  },
  {
    "n": "B5",
    "s16": 640,
    "d16": 1,
    "v": 0.9763779527559056
  }
];

  function noteToMidi(n) {
    n = String(n || "C4").trim();
    const m = n.match(/^([A-Ga-g])([#b]?)(-?\d+)$/);
    if (!m) return 60;
    const letter = m[1].toUpperCase();
    const acc = m[2] || "";
    const oct = parseInt(m[3], 10);
    const base = {C:0, D:2, E:4, F:5, G:7, A:9, B:11}[letter];
    let sem = base;
    if (acc === "#") sem += 1;
    if (acc === "b") sem -= 1;
    return (oct + 1) * 12 + sem;
  }

  function midiToFreq(m) { return 440 * Math.pow(2, (m - 69) / 12); }

  function calcTotalSteps16() {
    // Gesamtlänge = max(s16 + d16), aufrunden auf volle Takte (16 Steps)
    let maxEnd = 0;
    for (let i=0; i<EVENTS.length; i++) {
      const e = EVENTS[i];
      if (!e) continue;
      const end = (e.s16 || 0) + (e.d16 || 0);
      if (end > maxEnd) maxEnd = end;
    }
    const bars = Math.max(1, Math.ceil(maxEnd / 16));
    return bars * 16;
  }

function play() {
  if (!enabled) return;

  try {
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    if (!AudioCtx) return;

    const ctx = new AudioCtx();
    if (ctx.state === "suspended") ctx.resume();

    const BPM = 80;
    const QUARTER = 60 / BPM;
    const SIXTEENTH = QUARTER / 4;

    const VOLUME = 0.55;
    const TYPE = "sine";

    // >>> Stabilität bei Mehrstimmigkeit:
    // Für sehr schwache Geräte: 2–3, sonst 4
    const MAX_VOICES = 3;

    const now = ctx.currentTime + 0.02;

    // aktive Stimmen: { osc, stopAt }
    const active = [];

    // Events sortieren: gleicher Start zusammen, dann Tonhöhe
    const sorted = EVENTS.slice().sort((a, b) =>
      (a.s16 - b.s16) || (noteToMidi(a.n) - noteToMidi(b.n))
    );

    for (let i = 0; i < sorted.length; i++) {
      const e = sorted[i];
      if (!e || !e.n) continue;

      const t0 = now + (e.s16 * SIXTEENTH);
      const dur = Math.max(0.03, (e.d16 * SIXTEENTH));
      const stopAt = t0 + dur;

      // abgelaufene Stimmen entfernen
      for (let k = active.length - 1; k >= 0; k--) {
        if (active[k].stopAt <= t0) active.splice(k, 1);
      }

      // wenn zu viele Stimmen gleichzeitig: älteste abschalten ("steal")
      if (active.length >= MAX_VOICES) {
        const victim = active.shift();
        try { victim.osc.stop(t0); } catch (_) {}
      }

      const o = ctx.createOscillator();
      const g = ctx.createGain();

      o.type = TYPE;
      o.frequency.value = midiToFreq(noteToMidi(e.n));

      o.connect(g);
      g.connect(ctx.destination);

      const v = Math.max(0.0002, VOLUME * (typeof e.v === "number" ? e.v : 0.9));
      g.gain.setValueAtTime(0.0001, t0);
      g.gain.exponentialRampToValueAtTime(v, t0 + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, t0 + Math.max(0.02, dur - 0.01));

      o.start(t0);
      o.stop(stopAt);

      active.push({ osc: o, stopAt });
    }

    // garantiert kompletter Durchlauf (aufgerundete Taktlänge)
    const total16 = calcTotalSteps16();
    const totalSec = (total16 * SIXTEENTH) + 0.2;
    setTimeout(() => { try { ctx.close(); } catch(e){} }, totalSec * 1000);

  } catch (e) { }
}

  return { play, setEnabled, isEnabled };
})();
